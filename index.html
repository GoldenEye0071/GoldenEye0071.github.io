<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
	<script>
  		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  		})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  		ga('create', 'UA-104322608-1', 'auto');
  		ga('send', 'pageview');
		ga('set', 'userId', 'as8eknlll');
		ga(function(tracker) {
  			var clientId = tracker.get('userId');
  			console.log(clientId);
		});
		
		ga('send', 'event', 'Videos', 'play', 'Fall Campaign');
		ga('set', 'expId12s', 'hahaha456'); 
		ga(function(tracker) {
  			var clientId = tracker.get('expId12s');
  			console.log(clientId);
		});
	</script>
    <title>Restaurant</title>
    <style>
		
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
		widht:100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #description {
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
      }
      #infowindow-content .title {
        font-weight: bold;
      }
      #infowindow-content {
        display: none;
      }
      #map #infowindow-content {
        display: inline;
      }
      .pac-card {
        margin: 10px 10px 0 0;
        border-radius: 2px 0 0 2px;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        outline: none;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        background-color: #fff;
        font-family: Roboto;
      }
      #pac-container {
        padding-bottom: 12px;
        margin-right: 12px;
      }
      .pac-controls {
        display: inline-block;
        padding: 5px 11px;
      }
      .pac-controls label {
        font-family: Roboto;
        font-size: 13px;
        font-weight: 300;
      }
      #pac-input {
        background-color: #fff;
        font-family: Roboto;
        font-size: 15px;
        font-weight: 300;
        margin-left: 12px;
        padding: 0 11px 0 13px;
        text-overflow: ellipsis;
        width: 250px;
	  padding: 10px;
  	  border: none;
        border-bottom: solid 2px #c9c9c9;
        transition: border 0.3s;
      }
      #pac-input:focus {
        border-color: #4d90fe;
      }
      #title {
        color: #fff;
        background-color: #4d90fe;
        font-size: 25px;
        font-weight: 500;
        padding: 6px 12px;
      }
      #target {
        width: 345px;
      }
	 #floating-panel {
        position: absolute;
        top: 0;
        left: 40%;
        z-index: 5;
        background-color: #fff;
        padding: 5px;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;
      }
	#searchbox-panel{
	  background-color: #red;
        padding: 5px;
width:50%;
        border: 1px solid #999;
        text-align: center;
        font-family: 'Roboto','sans-serif';
        line-height: 30px;
        padding-left: 10px;      	
	}
#searchbox{
	padding:10px;
	margin:10px;
	//border:1px solid #999;	
	z-index:50;	
	display:inline;
}
input[type=checkbox], input[type=radio] {
  vertical-align: middle;
  position: relative;
  bottom: 1px;
}
input[type=radio] {
  bottom: 2px;
}
.inner-addon { 
    position: relative; 
}
/* style icon */
.inner-addon .glyphicon {
  position: absolute;
  padding: 10px;
  pointer-events: none;
}
/* align icon */
.left-addon .glyphicon  { left:  0px;}
.right-addon .glyphicon { right: 0px;}
/* add padding  */
.left-addon input  { padding-left:  30px; }
.right-addon input { padding-right: 30px; }
    </style>


	<link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/simple-sidebar.css" rel="stylesheet">
<script src="js/bootstrap-waitingfor.min.js"></script>
  </head>

  <body>
	  <div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog">

    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Modal Header</h4>
      </div>
      <div class="modal-body">
        <p>Some text in the modal.</p>
	      <div id="visit-count"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>

  </div>
</div>
	  
    <div id="searchbox">
	<div class="inner-addon right-addon">
		<i class="glyphicon glyphicon-search"></i>
		<input id="pac-input" class="form-control" type="text" value="Restaurant">
	</div>
 </div>
    <div id="wrapper">
        <!-- Sidebar -->
        <div id="sidebar-wrapper">
		<h3>Restaurant Type</h3>

 <label>
  <input type="checkbox" onclick="boxclick(this,'mixed')" checked>
  Mixed
</label><br>

           <label>
  <input type="checkbox"  onclick="boxclick(this,'pizza')" checked>
  Pizza
</label><br>
<label>
  <input type="checkbox" onclick="boxclick(this,'burger')" checked>
  Burger
</label><br>
 <label>
  <input type="checkbox" onclick="boxclick(this,'pork')" checked>
  Pork
</label><br>

<label>
  <input type="checkbox" onclick="boxclick(this,'chicken')" checked>
  Chicken
</label><br>	 
	 <label>
  <input type="checkbox" onclick="boxclick(this,'fastfood')" checked>
  Fast Food
</label><br>
 <label>
  <input type="checkbox" onclick="boxclick(this,'donut')" checked>
  Donut
</label><br>

	 <label>
  <input type="checkbox" onclick="boxclick(this,'dessert')" checked>
  Dessert
</label>
        </div>

        <!-- /#sidebar-wrapper -->
	
	<nav class="navbar navbar-inverse">
      		<div class="container">
        		<div class="navbar-header">
          		<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
           			 <span class="sr-only">Toggle navigation</span>
            			<span class="icon-bar"></span>
           			 <span class="icon-bar"></span>
            			<span class="icon-bar"></span>
         		</button>          
        		</div>
        		<div id="navbar" class="navbar-collapse collapse">
          		<ul class="nav navbar-nav navbar-left">
            				<li><a href="#menu-toggle" id="menu-toggle">Show Options</a></li>
            				<li><a href="#" onclick="clearCircle();">Clear Circle</a></li>
            				<li><a href="#" onclick="getCount();">Get Count</a></li>
				<li><a href= "#" onclick="openTest();">Visit Count</a></li> 
          		</ul>

        		</div><!--/.navbar-collapse -->
      		</div>
    	</nav>
	<div class="container">
		
		<div id="map"></div>
	</div>
	</div>

    <script>
      var customLabel = {
        restaurant: {
          label: 'R'
        },
        bar: {
          label: 'B'
        }
      };

		var directionsService ;
            var	directionsDisplay;
		var myLatLng;
		var latit;
      	var longit;
		var service;
		var markers_arr = [];
	        var visit_count_arr = [];
		var circle;
        function initMap() {

	var marker;
	var cebucity = {lat: 10.3157, lng: 123.8854};
        var map = new google.maps.Map(document.getElementById('map'), {
          center: cebucity ,
          zoom: 12,
		disableDefaultUI: true
        });

	
        var infoWindow = new google.maps.InfoWindow;
	  directionsService = new google.maps.DirectionsService;
        directionsDisplay = new google.maps.DirectionsRenderer;
	  directionsDisplay.setMap(map);
	service = new google.maps.places.PlacesService(map);
	getLocation();

	 var input = document.getElementById('pac-input');
		var tt = document.getElementById('searchbox');
        	var searchBox = new google.maps.places.SearchBox(input);
        	map.controls[google.maps.ControlPosition.TOP_LEFT].push(tt);
       		// Bias the SearchBox results towards current map's viewport.
        	map.addListener('bounds_changed', function() {
          		searchBox.setBounds(map.getBounds());
        	});
          // Change this depending on the name of your PHP or XML file
          downloadUrl('rest.xml', function(data) {
            var xml = data.responseXML;
            var markers = xml.documentElement.getElementsByTagName('marker');
		  var loopCount  = 0;
            Array.prototype.forEach.call(markers, function(markerElem) {
		    loopCount = loopCount + 1;
			console.log("pushing");
		
              var id = markerElem.getAttribute('id');
              var name = markerElem.getAttribute('name');
		  var category = markerElem.getAttribute('category');
              var address = markerElem.getAttribute('address');
              var type = markerElem.getAttribute('type');
              var point = new google.maps.LatLng(
                  parseFloat(markerElem.getAttribute('lat')),
                  parseFloat(markerElem.getAttribute('lng')));

              var infowincontent = document.createElement('div');
              var strong = document.createElement('strong');
              strong.textContent = name + ' ' + category
              infowincontent.appendChild(strong);
              infowincontent.appendChild(document.createElement('br'));
		
              var text = document.createElement('text');
              text.textContent = address + ' ' + category;
              infowincontent.appendChild(text);
		//	infowincontent.appendChild()
              var icon = customLabel[type] || {};
              marker = new google.maps.Marker({
                map: map,
                position: point,
                label: icon.label
              });

		marker.mycategory = category;
		marker.myid = loopCount;
		    marker.name = name;
		    console.log("loopcount " + loopCount + " my id " + marker.myid);
			markers_arr.push(marker);
		   
 		  // google.maps.event.addListener(marker, 'click', function() {
        		//	 latit = marker.getPosition().lat();
		 	//	longit = marker.getPosition().lng();               	
        	  // });		
		 ga('set', "markercount" +  marker.myid, 0);
              marker.addListener('click', function() {
		     console.log("this my id " + this.myid);
		     // var markerCount =  ga('get', "markercount" + id);
		     // console.log("count " + markerCount);
		    // markerCount = markerCount + 1;
		    //  ga('set', "markercount" + id, markerCount);
		      var markerCount;
		      var me = this;
		      ga(function(tracker) {
  			markerCount = tracker.get("markercount" + me.myid);	
			console.log("me " + me.myid);
			markerCount += 1;
			      
			console.log(markerCount);
		      });
		      visit_count_arr[this.myid]  = markerCount;
		      ga('set', "markercount" + this.myid, markerCount);
		      
                infoWindow.setContent(infowincontent);
                infoWindow.open(map, marker);
			latit = this.getPosition().lat();
		 	longit = this.getPosition().lng();           
		//console.log(latit + " " + longit);    
			 directionsService.route({
                        // origin: document.getElementById('start').value,
                        origin: myLatLng,
                        // destination: marker.getPosition(),
                        destination: {
                            lat: latit,
                            lng: longit
                        },
                        travelMode: 'DRIVING'
                    }, function(response, status) {
                        if (status === 'OK') {
                            directionsDisplay.setDirections(response);
                        } else {
                            window.alert('Directions request failed due to ' + status);
                        }
                    });
			
              });
            });
		
          });
		
		//console.log(markers_arr.length);
		//for(var i=0; i < markers_arr.length; i++){
		//	console.log(markers_arr[i].getPosition());
		//}

		circle = new google.maps.Circle({
           		 center: cebucity,
            		radius: 10,
            		strokeColor: "#0000FF",
            		strokeOpacity: 0.8,
            		strokeWeight: 2,
           		fillColor: "#0000FF",
            		fillOpacity: 0.4,
            		clickable: false
        	 });
		 new LongPress(map, 500);
    		 var t;
    		 google.maps.event.addListener(map, 'longpress', function (e) {
        		var radius = 100;
			if (circle != null)
			{
				circle.setMap(null);
			}
        		// Draw a circle around the radius
        		circle = new google.maps.Circle({
           			 center: e.latLng,
            			radius: radius,
            			strokeColor: "#0000FF",
            			strokeOpacity: 0.8,
            			strokeWeight: 2,
           			 fillColor: "#0000FF",
            			fillOpacity: 0.4,
            			clickable: false
        	 	});
       	 		circle.setMap(map);
        		var start = 2;
        		var speedup = 1;
        		var grow = function () {
            			radius = radius + 50;
            			circle.setRadius(radius);
            			t = setTimeout(grow, start);
            			start = start / speedup;
			}
        		grow();
   	 	});
    		google.maps.event.addListener(map, 'mouseup', function (e) {
         		clearTimeout(t);
			console.log(circle.getRadius());			
    		});
		google.maps.event.addListener(map, 'doubleclick', function() {
      			circle.setMap(null);			
  		});
        }

	    function openTest()
	    {
	    	console.log("dfd");
		    var visitcount = '<table><tr><td>Name</td><td>Count</td></tr>';
		    for(var i = 0; i < markers_arr.length; i++){
			var marker = markers_arr[i];
			var  count = visit_count_arr[marker.myid];
			//ga(function(tracker) {
  			// count = tracker.get(marker.myid);
  				 if(count > 0)
		    		visitcount = visitcount + '<tr><td>' + marker.name + '</td><td>' + count + '</td></tr>' ;
			//});
			   
		    }
		    
		    visitcount = visitcount + '</table>';
		    $('#visit-count').html(visitcount);
		  $('#myModal').modal('show');   
	    }

	function getCount()
	{
		var loc1 = myLatLng; //Marker Radius Co-ords
		var loc11 = circle.getCenter(); //new google.maps.LatLng(myLatLng.lat, myLatLng.lng); 
		var c =0;
		//console.log(myLatLng.lat);
		for(var i=0; i < markers_arr.length; i++){
			//console.log(markers_arr[i].getPosition().lat() + "  " +  markers_arr[i].getPosition().lng());
			var loc2 = new google.maps.LatLng(markers_arr[i].getPosition().lat(), markers_arr[i].getPosition().lng()); //Marker Co-ords

			var diff = google.maps.geometry.spherical.computeDistanceBetween(loc11 , loc2);
			if (diff < circle.getRadius())
				c =c + 1;
			
		}
		//console.log(c);
		alert("Restaurant count within circle is " + c);
		
	}
      function downloadUrl(url, callback) {
        var request = window.ActiveXObject ?
            new ActiveXObject('Microsoft.XMLHTTP') :
            new XMLHttpRequest;

        request.onreadystatechange = function() {
          if (request.readyState == 4) {
            request.onreadystatechange = doNothing;
            callback(request, request.status);
          }
        };

        request.open('GET', url, true);
        request.send(null);
      }

      function doNothing() {}

	function geoError()
	{
            alert("Geocoder failed.");
        }

	function geoSuccess(position)
	{
		var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;
		
		 myLatLng = {
                lat: latitude,
                lng: longitude
            };
	}
	
	function getLocation() {
		var options = {
  			enableHighAccuracy: true,
  			timeout: 5000,
  			maximumAge: 0
		};
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(geoSuccess, geoError,options);
                // alert("Geolocation is supported by this browser.");
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }
	
	function LongPress(map, length) {
    		this.length_ = length;
    		var me = this;
    		me.map_ = map;
    		me.timeoutId_ = null;
    		google.maps.event.addListener(map, 'mousedown', function (e) {
        		me.onMouseDown_(e);
    		});
   		 google.maps.event.addListener(map, 'mouseup', function (e) {
        		me.onMouseUp_(e);
   		 });
    		google.maps.event.addListener(map, 'drag', function (e) {
       		 me.onMapDrag_(e);
    		});
	};
	
	LongPress.prototype.onMouseUp_ = function (e) {
    		clearTimeout(this.timeoutId_);
	};
	LongPress.prototype.onMouseDown_ = function (e) {
    		clearTimeout(this.timeoutId_);
    		var map = this.map_;
    		var event = e;
    		this.timeoutId_ = setTimeout(function () {
        		google.maps.event.trigger(map, 'longpress', event);
    		}, this.length_);
	};
	LongPress.prototype.onMapDrag_ = function (e) {
    		clearTimeout(this.timeoutId_);
	};
	
function hide(category)
{
	 for (var i=0; i<markers_arr.length; i++) {
          if (markers_arr[i].mycategory == category) {
            markers_arr[i].setVisible(false);
          }
        }
        // == clear the checkbox ==
       // document.getElementById(category+"box").checked = false;
        // == close the info window, in case its open on a marker that we just hid
       // infowindow.close();
}

 function show(category) {
        for (var i=0; i<markers_arr.length; i++) {
          if (markers_arr[i].mycategory == category) {
            markers_arr[i].setVisible(true);
          }
        }
        // == check the checkbox ==
      //document.getElementById(category+"box").checked = true;
   }


  function boxclick(box,category) {
        if (box.checked) {
          show(category);
        } else {
          hide(category);
        }
        // == rebuild the side bar
       // makeSidebar();
      }

	function clearCircle()
{
	circle.setMap(null)
}
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCkdGVTeOTuF9wG07oFHrk5Mc6gaCr1wRM&libraries=places&callback=initMap" async defer></script>

	<script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Menu Toggle Script -->
    <script>
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    </script>   
	  
  </body>
</html>
